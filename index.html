<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üìú Tuy·ªÉn t·∫≠p Th∆° Nghe - Giao di·ªán m·ªõi</title>
  <!-- Google Fonts: Inter -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    /*
     * GIAO DI·ªÜN NEUMORPHIC T·ªêI HI·ªÜN ƒê·∫†I
     * B·∫£ng ki·ªÉu n√†y tri·ªÉn khai thi·∫øt k·∫ø "Soft UI" hay Neumorphic tr√™n n·ªÅn t·ªëi.
     * Nguy√™n t·∫Øc ch√≠nh:
     * 1. N·ªÅn: N·ªÅn kh√¥ng ph·∫£i m√†u ƒëen ph·∫≥ng, m√† l√† m·ªôt m√†u t·ªëi, kh·ª≠ b√£o h√≤a.
     * 2. ƒê·ªô n·ªïi: C√°c ph·∫ßn t·ª≠ ƒë∆∞·ª£c t·∫°o hi·ªáu ·ª©ng nh∆∞ ƒëang l·ªìi ra ho·∫∑c l√µm v√†o so v·ªõi n·ªÅn.
     * ƒêi·ªÅu n√†y ƒë·∫°t ƒë∆∞·ª£c b·∫±ng c√°ch k·∫øt h·ª£p hai lo·∫°i b√≥ng ƒë·ªï: m·ªôt b√≥ng s√°ng (tr√™n-tr√°i) v√† m·ªôt b√≥ng t·ªëi (d∆∞·ªõi-ph·∫£i).
     * 3. B·∫£ng m√†u: B·∫£ng m√†u t·ªëi gi·∫£n v·ªõi m·ªôt m√†u nh·∫•n s·ªëng ƒë·ªông duy nh·∫•t cho c√°c ph·∫ßn t·ª≠ t∆∞∆°ng t√°c.
    */

    :root {
      --background-color: #2c313a; /* M√†u than c·ªßi t·ªëi, h∆°i ng·∫£ xanh */
      --text-color-primary: #e0e5ec; /* M√†u tr·∫Øng x√°m m·ªÅm m·∫°i ƒë·ªÉ d·ªÖ ƒë·ªçc */
      --text-color-secondary: #97a0ae; /* M√†u x√°m nh·∫°t cho th√¥ng tin ph·ª• */
      --accent-color: #00a8ff; /* M√†u xanh d∆∞∆°ng ƒëi·ªán t·ª≠ s·ªëng ƒë·ªông cho ti√™u ƒëi·ªÉm v√† t∆∞∆°ng t√°c */
      --accent-color-darker: #0086cc;
      --shadow-light: rgba(255, 255, 255, 0.05); /* B√≥ng ƒë·ªï s√°ng tinh t·∫ø */
      --shadow-dark: rgba(0, 0, 0, 0.4); /* B√≥ng ƒë·ªï t·ªëi s√¢u h∆°n */
      --element-bg: #2c313a; /* C√°c ph·∫ßn t·ª≠ c√≥ c√πng m√†u n·ªÅn trong neumorphism */
      --border-radius-main: 20px;
      --border-radius-small: 15px;
    }

    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--background-color);
      margin: 0;
      padding: 1.5rem;
      line-height: 1.6;
      color: var(--text-color-primary);
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      padding-bottom: 200px; /* Kho·∫£ng tr·ªëng cho thanh ƒëi·ªÅu khi·ªÉn cao h∆°n */
      transition: background 0.3s ease;
    }

    /* V√πng ch·ª©a ·ª©ng d·ª•ng ch√≠nh - Ki·ªÉu Neumorphic */
    .container {
      max-width: 900px;
      margin: 2rem auto;
      background: var(--element-bg);
      border-radius: var(--border-radius-main);
      padding: 2rem;
      /* Hi·ªáu ·ª©ng "n·ªïi" c·ªßa Neumorphic */
      box-shadow: 
        9px 9px 18px var(--shadow-dark),
        -9px -9px 18px var(--shadow-light);
      transition: all 0.4s ease;
    }

    /* Ph·∫ßn ti√™u ƒë·ªÅ */
    .header-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        margin-bottom: 2rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    h1 {
      font-size: 2.2rem;
      color: var(--text-color-primary);
      margin: 0;
      font-weight: 700;
      letter-spacing: -0.5px;
      text-shadow: 1px 1px 2px var(--shadow-dark);
    }

    .header-nav {
      display: flex;
      gap: 0.75rem;
      align-items: center;
    }

    /* Ki·ªÉu n√∫t b·∫•m chu·∫©n - Neumorphic */
    .nav-button, .dropdown-toggle {
      padding: 0.8rem 1.3rem;
      font-size: 0.9rem;
      font-weight: 500;
      border-radius: 50px; /* D·∫°ng vi√™n thu·ªëc */
      border: none;
      background: var(--element-bg);
      color: var(--text-color-secondary);
      cursor: pointer;
      text-decoration: none;
      transition: all 0.2s ease-in-out;
      box-shadow: 
        5px 5px 10px var(--shadow-dark),
        -5px -5px 10px var(--shadow-light);
    }

    .nav-button:hover, .dropdown-toggle:hover {
      color: var(--accent-color);
      box-shadow: 
        3px 3px 6px var(--shadow-dark),
        -3px -3px 6px var(--shadow-light);
    }

    /* Tr·∫°ng th√°i "nh·∫•n" ho·∫∑c ƒëang ho·∫°t ƒë·ªông c·ªßa n√∫t */
    .nav-button:active, .dropdown-toggle:active, .dropdown.active .dropdown-toggle {
      color: var(--accent-color);
      box-shadow: 
        inset 4px 4px 8px var(--shadow-dark),
        inset -4px -4px 8px var(--shadow-light);
    }

    /* Menu th·∫£ xu·ªëng */
    .dropdown { position: relative; display: inline-block; }
    .dropdown-menu {
        display: none;
        position: absolute;
        background: var(--element-bg);
        min-width: 180px;
        z-index: 1001;
        right: 0;
        margin-top: 10px;
        border-radius: var(--border-radius-small);
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 8px 8px 16px var(--shadow-dark);
    }
    .dropdown-menu a {
        color: var(--text-color-secondary);
        padding: 12px 18px;
        text-decoration: none;
        display: block;
        transition: all 0.2s ease;
    }
    .dropdown-menu a:hover {
        background: rgba(0, 0, 0, 0.2);
        color: var(--accent-color);
    }
    .dropdown.active .dropdown-menu { display: block; }

    /* === C·∫¨P NH·∫¨T: √î t√¨m ki·∫øm - Ki·ªÉu "l√µm" Neumorphic === */
    #search-wrapper {
      position: relative;
      margin: 1.5rem 0;
      display: flex; /* D√πng flexbox ƒë·ªÉ s·∫Øp x·∫øp */
      align-items: center;
      gap: 0.75rem; /* Kho·∫£ng c√°ch gi·ªØa √¥ t√¨m ki·∫øm v√† n√∫t micro */
    }
    #search {
      width: 100%;
      flex-grow: 1; /* Cho ph√©p √¥ t√¨m ki·∫øm chi·∫øm h·∫øt kh√¥ng gian c√≤n l·∫°i */
      padding: 1rem 1.5rem;
      font-size: 1rem;
      border-radius: 50px;
      border: none;
      background: var(--element-bg);
      color: var(--text-color-primary);
      transition: all 0.2s ease-in-out;
      /* Hi·ªáu ·ª©ng "l√µm" ho·∫∑c ƒë∆∞·ª£c nh·∫•n v√†o */
      box-shadow: 
        inset 5px 5px 10px var(--shadow-dark),
        inset -5px -5px 10px var(--shadow-light);
    }
    #search::placeholder { color: var(--text-color-secondary); }
    #search:focus {
      outline: none;
      box-shadow: 
        inset 3px 3px 6px var(--shadow-dark),
        inset -3px -3px 6px var(--shadow-light),
        0 0 0 2px var(--accent-color); /* V√≤ng s√°ng khi focus */
    }
    
    /* === TH√äM M·ªöI: N√∫t t√¨m ki·∫øm b·∫±ng gi·ªçng n√≥i === */
    #voice-search-btn {
      flex-shrink: 0; /* Kh√¥ng cho n√∫t b·ªã co l·∫°i */
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      background: var(--element-bg);
      color: var(--text-color-secondary);
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      box-shadow: 
        5px 5px 10px var(--shadow-dark),
        -5px -5px 10px var(--shadow-light);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.8rem; /* C·∫¨P NH·∫¨T: TƒÉng k√≠ch th∆∞·ªõc icon */
    }
    #voice-search-btn:hover {
      color: var(--accent-color);
    }
    #voice-search-btn:active, #voice-search-btn.listening {
      color: #fff;
      background: var(--accent-color);
      box-shadow: 
        inset 3px 3px 6px #0076b8,
        inset -3px -3px 6px #00daff,
        0 0 15px var(--accent-color);
    }
    
    #search-suggestions {
        position: absolute;
        top: calc(100% + 8px);
        left: 0;
        right: 0;
        background: var(--element-bg);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: var(--border-radius-small);
        box-shadow: 8px 8px 16px var(--shadow-dark);
        z-index: 10;
        max-height: 200px;
        overflow-y: auto;
        display: none;
        list-style: none;
        padding: 0.5rem 0;
    }
    #search-suggestions li {
        padding: 0.8rem 1.5rem;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    #search-suggestions li:hover {
        background: rgba(0, 0, 0, 0.2);
        color: var(--accent-color);
    }
    
    #search-result-count {
      margin: -1rem 0 1.5rem;
      color: var(--text-color-secondary);
      font-weight: 500;
      text-align: center;
      font-size: 0.9rem;
      min-height: 1.2rem;
    }

    /* === C·∫¨P NH·∫¨T: M·ª•c l·ª•c (TOC) === */
    .toc {
      display: flex;
      overflow-x: auto;
      gap: 0.3rem; /* GI·∫¢M TH√äM: Kho·∫£ng c√°ch gi·ªØa c√°c m·ª•c */
      padding-bottom: 0.8rem; /* Th√™m kho·∫£ng tr·ªëng cho thanh cu·ªôn */
      margin-bottom: 1.5rem;
      scrollbar-width: thin; /* HI·ªÇN TH·ªä: Thanh cu·ªôn cho Firefox */
      scrollbar-color: var(--accent-color) rgba(0,0,0,0.2);
    }
    .toc::-webkit-scrollbar {
      height: 6px; /* HI·ªÇN TH·ªä: Chi·ªÅu cao thanh cu·ªôn */
    }
    .toc::-webkit-scrollbar-track {
      background: rgba(0,0,0,0.2); /* HI·ªÇN TH·ªä: M√†u n·ªÅn thanh cu·ªôn */
      border-radius: 3px;
    }
    .toc::-webkit-scrollbar-thumb {
      background-color: var(--accent-color); /* HI·ªÇN TH·ªä: M√†u c·ªßa con tr∆∞·ª£t */
      border-radius: 3px;
    }

    .toc a {
      flex-shrink: 0;
      padding: 0.2rem 0.5rem; /* GI·∫¢M TH√äM: Padding t·ªëi ƒëa */
      border-radius: 20px;
      text-decoration: none;
      color: var(--text-color-secondary);
      font-size: 0.7rem; /* GI·∫¢M TH√äM: C·ª° ch·ªØ t·ªëi ƒëa */
      font-weight: 500;
      white-space: nowrap;
      transition: all 0.2s ease-in-out;
      background: var(--element-bg);
      box-shadow:
        3px 3px 6px var(--shadow-dark), /* Gi·∫£m nh·∫π b√≥ng ƒë·ªï */
        -3px -3px 6px var(--shadow-light);
    }
    .toc a:hover {
      color: var(--text-color-primary);
    }
    .toc a.active {
      color: var(--accent-color);
      box-shadow: 
        inset 2px 2px 4px var(--shadow-dark),
        inset -2px -2px 4px var(--shadow-light);
    }

    /* === C·∫¨P NH·∫¨T: Ki·ªÉu c·ªßa m·ª•c Accordion === */
    details {
      margin: 0.35rem 0; /* GI·∫¢M TH√äM: Kho·∫£ng c√°ch gi·ªØa c√°c b√†i th∆° */
      border-radius: var(--border-radius-small);
      overflow: hidden;
      transition: all 0.3s ease;
      background: var(--element-bg);
       box-shadow: 
        7px 7px 14px var(--shadow-dark),
        -7px -7px 14px var(--shadow-light);
    }
    details[open] {
      box-shadow: 
        inset 5px 5px 10px var(--shadow-dark),
        inset -5px -5px 10px var(--shadow-light);
    }
    
    summary {
      cursor: pointer;
      padding: 0.5rem 1rem 0.5rem 2rem; /* GI·∫¢M TH√äM: Padding t·ªëi ƒëa */
      list-style: none;
      position: relative;
      font-weight: 500;
      font-size: 0.9rem; /* GI·∫¢M TH√äM: C·ª° ch·ªØ ti√™u ƒë·ªÅ t·ªëi ƒëa */
      color: var(--text-color-primary);
      transition: all 0.3s ease;
    }
    summary::-webkit-details-marker { display: none; }
    details[open] summary {
      color: var(--accent-color);
    }

    summary::before {
      content: '‚ñ∫';
      position: absolute;
      left: 0.7rem; /* ƒêi·ªÅu ch·ªânh v·ªã tr√≠ icon m≈©i t√™n */
      top: 50%;
      transform: translateY(-50%) rotate(0deg);
      transition: transform 0.2s ease, color 0.3s ease;
      font-size: 0.7rem;
      color: var(--text-color-secondary);
    }
    details[open] summary::before {
      transform: translateY(-50%) rotate(90deg);
      color: var(--accent-color);
    }

    .content-body {
      padding: 0.5rem 1.5rem 1.5rem 1.5rem;
      font-size: 1rem;
      color: var(--text-color-secondary);
      line-height: 1.7;
      border-top: 1px solid rgba(255, 255, 255, 0.08);
    }
    img {
      max-width: 100%;
      height: auto;
      border-radius: var(--border-radius-small);
      margin-top: 1rem;
      display: block;
    }
    mark.highlight {
      background-color: var(--accent-color);
      color: #111;
      font-weight: 600;
      padding: 2px 4px;
      border-radius: 4px;
    }
    
    /* === TH√äM M·ªöI: N√∫t Chia s·∫ª === */
    .share-button-container {
        margin-top: 1.5rem;
        text-align: left; /* CƒÉn tr√°i n√∫t */
    }
    .share-btn {
        padding: 0.6rem 1.2rem;
        font-size: 0.9rem;
        font-weight: 500;
        border-radius: 50px;
        border: none;
        background: var(--element-bg);
        color: var(--text-color-secondary);
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        box-shadow:
            4px 4px 8px var(--shadow-dark),
            -4px -4px 8px var(--shadow-light);
    }
    .share-btn:hover {
        color: var(--accent-color);
    }
    .share-btn:active {
        box-shadow:
            inset 3px 3px 6px var(--shadow-dark),
            inset -3px -3px 6px var(--shadow-light);
    }
    
    /* === TH√äM M·ªöI: Modal Chia s·∫ª === */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 2000;
        display: none; /* ·∫®n m·∫∑c ƒë·ªãnh */
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(5px);
    }
    .modal-box {
        background: var(--background-color);
        padding: 2rem;
        border-radius: var(--border-radius-main);
        text-align: center;
        max-width: 90%;
        width: 400px;
        box-shadow:
            12px 12px 24px var(--shadow-dark),
            -12px -12px 24px var(--shadow-light);
    }
    .modal-box p {
        margin-top: 0;
        margin-bottom: 1.5rem;
        color: var(--text-color-primary);
        line-height: 1.6;
    }
    #share-modal-close-btn {
        padding: 0.8rem 2rem;
        font-size: 1rem;
        font-weight: 600;
        border-radius: 50px;
        border: none;
        background: var(--accent-color);
        color: #fff;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        box-shadow:
            5px 5px 10px rgba(0,0,0,0.2),
            -5px -5px 10px rgba(255,255,255,0.1);
    }
    #share-modal-close-btn:hover {
        background: var(--accent-color-darker);
    }
    #share-modal-close-btn:active {
       box-shadow:
            inset 3px 3px 6px var(--shadow-dark),
            inset -3px -3px 6px var(--shadow-light);
    }

    /* === KI·ªÇU THANH ƒêI·ªÄU KHI·ªÇN ƒê√É C·∫¨P NH·∫¨T === */
    .fixed-player-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: var(--background-color);
        box-shadow: 0 -10px 30px rgba(0,0,0,0.3);
        padding: 1rem 1.2rem;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.8rem; /* Gi·∫£m kho·∫£ng c√°ch gi·ªØa c√°c h√†ng */
        border-top: 1px solid var(--shadow-light);
    }

    /* H√†ng 1: Thanh ti·∫øn tr√¨nh */
    .player-row-1 {
      width: 100%;
    }

    /* H√†ng 2: T·∫•t c·∫£ c√°c n√∫t ƒëi·ªÅu khi·ªÉn */
    .player-row-2 {
      display: flex;
      gap: 1rem;
      align-items: center;
      width: 100%;
      justify-content: center;
      flex-wrap: wrap; /* Cho ph√©p xu·ªëng d√≤ng tr√™n m√†n h√¨nh nh·ªè */
    }

    /* C√°c n√∫t ƒëi·ªÅu khi·ªÉn */
    .player-row-2 button {
      flex-shrink: 0;
      width: 50px;
      height: 50px;
      padding: 0;
      font-size: 1.2rem;
      border-radius: 50%; /* N√∫t tr√≤n */
      border: none;
      background: var(--element-bg);
      color: var(--text-color-secondary);
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 
        5px 5px 10px var(--shadow-dark),
        -5px -5px 10px var(--shadow-light);
    }

    /* N√∫t Ph√°t/D·ª´ng l·ªõn h∆°n, ·ªü trung t√¢m */
    #play-pause-btn {
        width: 65px;
        height: 65px;
        font-size: 1.8rem;
        order: 0; /* Gi·ªØ ·ªü gi·ªØa */
    }

    .player-row-2 button:hover {
      color: var(--accent-color);
    }
    .player-row-2 button:active {
      color: var(--accent-color);
      box-shadow: 
        inset 4px 4px 8px var(--shadow-dark),
        inset -4px -4px 8px var(--shadow-light);
    }
    .player-row-2 button.active-auto {
      color: #fff;
      background: var(--accent-color);
      box-shadow: 
        inset 3px 3px 6px #0076b8,
        inset -3px -3px 6px #00daff,
        0 0 15px var(--accent-color);
    }

    /* ƒêi·ªÅu khi·ªÉn √Çm l∆∞·ª£ng/T·ªëc ƒë·ªô */
    .player-row-2 label {
      display: flex;
      align-items: center;
      gap: 0.5em;
      font-size: 1rem;
    }
    .player-row-2 label span {
        font-size: 0.8em;
        font-weight: 500;
        color: var(--text-color-secondary);
        min-width: 35px;
        text-align: center;
    }
    input[type=range] {
        -webkit-appearance: none; appearance: none;
        width: 80px; /* L√†m thanh tr∆∞·ª£t nh·ªè g·ªçn h∆°n m·ªôt ch√∫t */
        height: 6px;
        background: var(--background-color);
        border-radius: 5px;
        outline: none;
        box-shadow: 
          inset 2px 2px 4px var(--shadow-dark),
          inset -2px -2px 4px var(--shadow-light);
    }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--text-color-secondary);
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 2px 2px 4px var(--shadow-dark);
    }
    input[type=range]:hover::-webkit-slider-thumb {
        background: var(--accent-color);
    }
    input[type=range]::-moz-range-thumb {
      width: 20px; height: 20px; border-radius: 50%;
      background: var(--text-color-secondary); cursor: pointer;
    }

    /* Thanh ti·∫øn tr√¨nh */
    .speech-progress {
        flex-grow: 1;
        height: 8px;
        background: var(--background-color);
        border-radius: 5px;
        overflow: hidden;
        box-shadow: 
          inset 3px 3px 6px var(--shadow-dark),
          inset -3px -3px 6px var(--shadow-light);
    }
    .speech-progress-bar {
      height: 100%;
      background: var(--accent-color);
      width: 0%;
      transition: width 0.2s linear;
      border-radius: 5px;
    }
    
    /* === C·∫¨P NH·∫¨T: C·ª•m n√∫t cu·ªôn trang === */
    .scroll-nav-btn {
      position: fixed; /* ƒê·∫∑t v·ªã tr√≠ c·ªë ƒë·ªãnh */
      bottom: 20px;
      z-index: 1002;
      width: 50px;
      height: 50px;
      padding: 0;
      font-size: 1.5rem;
      font-weight: bold;
      line-height: 1;
      border-radius: 50%;
      border: none;
      background: var(--element-bg);
      color: var(--text-color-secondary);
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 
        5px 5px 10px var(--shadow-dark),
        -5px -5px 10px var(--shadow-light);
    }
    .scroll-nav-btn:hover {
      color: var(--accent-color);
    }
    .scroll-nav-btn:active {
      color: var(--accent-color);
      box-shadow: 
        inset 4px 4px 8px var(--shadow-dark),
        inset -4px -4px 8px var(--shadow-light);
    }
    #scroll-to-top-button {
      right: 20px; /* ƒê·∫∑t ·ªü b√™n ph·∫£i */
    }
    #scroll-to-end-button {
      left: 20px; /* ƒê·∫∑t ·ªü b√™n tr√°i */
    }

    /* Th√¥ng b√°o d·ª± ph√≤ng */
    #fallback {
      display: none;
      text-align: center;
      margin-top: 2rem;
      padding: 1.5rem;
      background: #3e3020;
      border-radius: var(--border-radius-small);
      color: #ffc107;
    }

    /* ƒêi·ªÅu ch·ªânh cho c√°c k√≠ch th∆∞·ªõc m√†n h√¨nh kh√°c nhau */
    @media (max-width: 768px) {
      body { padding: 1rem; padding-bottom: 220px; }
      .container { padding: 1.5rem; margin: 1rem auto; }
      h1 { font-size: 1.8rem; }
      .header-container { flex-direction: column; gap: 1.5rem; }
      .fixed-player-bar { padding: 1rem; }
    }
    @media (max-width: 480px) {
      body { padding: 0.5rem; padding-bottom: 220px; }
      .container { padding: 1rem; }
      h1 { font-size: 1.6rem; }
      summary { padding: 0.8rem 1rem 0.8rem 2.2rem; font-size: 1rem; }
      summary::before { left: 0.8rem; }
      .content-body { padding: 0.5rem 1rem 1rem 1rem; }
      .scroll-nav-btn { width: 40px; height: 40px; font-size: 1rem;}
      #scroll-to-top-button { right: 15px; }
      #scroll-to-end-button { left: 15px; }
      .player-row-2 { gap: 0.5rem; } /* Kho·∫£ng c√°ch h·∫πp h∆°n tr√™n m√†n h√¨nh nh·ªè nh·∫•t */
      input[type=range] { width: 60px; } /* Thu nh·ªè thanh tr∆∞·ª£t h∆°n */
    }

  </style>
</head>
<body>
  <div class="container">
    <div class="header-container">
      <h1>üìú Tuy·ªÉn t·∫≠p Th∆° Nghe</h1>
      <div class="header-nav">
        <a href="https://sites.google.com/view/thiensutinhquang" target="_blank" class="nav-button">Trang ch·ªß</a>
        <div class="dropdown">
          <button class="dropdown-toggle">M·∫°ng x√£ h·ªôi</button>
          <div class="dropdown-menu">
            <a href="https://www.youtube.com/channel/UCLdLj1-g4TI5lSmWeD60mnA" target="_blank">üì∫ Youtube</a>
            <a href="https://www.tiktok.com/@minhsutinhquang" target="_blank">üéµ TikTok</a>
            <a href="https://www.facebook.com/phatphapnhiemmauTinhQuang" target="_blank">üìò Facebook</a>
            <a href="https://t.me/Giaoly_phap_don_ngo" target="_blank">üí¨ Zalo</a>
          </div>
        </div>
      </div>
    </div>
    
    <div id="search-wrapper">
        <input type="text" id="search" placeholder="T√¨m ki·∫øm theo ti√™u ƒë·ªÅ ho·∫∑c n·ªôi dung..." autocomplete="off"/>
        <button id="voice-search-btn" title="T√¨m ki·∫øm b·∫±ng gi·ªçng n√≥i">üéôÔ∏è</button>
    </div>
    <p id="search-result-count"></p>
    <div class="toc" id="toc">ƒêang t·∫£i d·ªØ li·ªáu...</div>
    <div id="accordion"></div>
    <div id="fallback">
      ‚ö†Ô∏è Tr√¨nh duy·ªát hi·ªán t·∫°i kh√¥ng h·ªó tr·ª£ hi·ªÉn th·ªã d·ªØ li·ªáu t·ª´ Google Sheets.<br>
      <a href="https://docs.google.com/spreadsheets/d/e/2PACX-1vTjl66tsHr053yFDCTxSKViC0G24MNzmaW7ofFMMSMJVwHBOslw6usujYUvcDnnymA7ZFbL1BZ6QEYf/pubhtml" target="_blank">Vui l√≤ng xem danh s√°ch b√†i th∆° t·∫°i ƒë√¢y</a>.
    </div>
  </div>

  <div class="fixed-player-bar">
    <!-- H√†ng 1: Thanh ti·∫øn tr√¨nh -->
    <div class="player-row-1">
        <div class="speech-progress">
            <div class="speech-progress-bar"></div>
        </div>
    </div>
    <!-- H√†ng 2: T·∫•t c·∫£ c√°c n√∫t ƒëi·ªÅu khi·ªÉn -->
    <div class="player-row-2">
        <label title="√Çm l∆∞·ª£ng">
          üîâ
          <input type="range" id="volume-slider" min="0" max="1" step="0.1" value="1">
          <span id="volume-value">10</span>
        </label>
        <button id="prev-btn" title="B√†i tr∆∞·ªõc">‚èÆÔ∏è</button>
        <button id="play-pause-btn" title="Ph√°t/D·ª´ng">‚ñ∂Ô∏è</button>
        <button id="next-btn" title="B√†i k·∫ø ti·∫øp">‚è≠Ô∏è</button>
        <button id="loop-btn" title="L·∫∑p l·∫°i" class="loop-toggle-button">üîÅ</button>
        <label title="T·ªëc ƒë·ªô">
          ‚è©
          <input type="range" id="rate-slider" min="0.5" max="2" step="0.25" value="1">
          <span id="rate-value">1.0x</span>
        </label>
    </div>
  </div>
  
  <div id="share-modal-overlay" class="modal-overlay">
    <div class="modal-box">
      <p>L·ªùi th∆° c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c copy to√†n b·ªô v√†o b·ªô nh·ªõ t·∫°m. Gi·ªù b·∫°n h√£y d√°n n√≥ v√†o c√°c n·ªÅn t·∫£ng ƒë·ªÉ chia s·∫ª b√†i th∆° hay n√†y.</p>
      <button id="share-modal-close-btn">OK</button>
    </div>
  </div>

  <button id="scroll-to-top-button" class="scroll-nav-btn" title="L√™n ƒë·∫ßu trang">‚ñ≤</button>
  <button id="scroll-to-end-button" class="scroll-nav-btn" title="Xu·ªëng cu·ªëi trang">‚ñº</button>

  <!-- Th∆∞ vi·ªán -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>

  <script>
    // S·ª¨A L·ªñI: B·ªçc to√†n b·ªô m√£ trong DOMContentLoaded ƒë·ªÉ ƒë·∫£m b·∫£o HTML ƒë∆∞·ª£c t·∫£i xong tr∆∞·ªõc khi JS ch·∫°y
    document.addEventListener('DOMContentLoaded', () => {
        // URL c·ªßa Google Sheet ƒë√£ xu·∫•t b·∫£n d∆∞·ªõi d·∫°ng CSV
        const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTjl66tsHr053yFDCTxSKViC0G24MNzmaW7ofFMMSMJVwHBOslw6usujYUvcDnnymA7ZFbL1BZ6QEYf/pub?output=csv";
        let originalData = []; // L∆∞u tr·ªØ d·ªØ li·ªáu g·ªëc t·ª´ Google Sheet
        let displayData = []; // S·ª¨A L·ªñI: D·ªØ li·ªáu ƒëang ƒë∆∞·ª£c hi·ªÉn th·ªã (c√≥ th·ªÉ l√† k·∫øt qu·∫£ t√¨m ki·∫øm)
        let fuse = null; // ƒê·ªëi t∆∞·ª£ng Fuse.js ƒë·ªÉ t√¨m ki·∫øm m·ªù
        let currentUtterance = null; // ƒê·ªëi t∆∞·ª£ng SpeechSynthesisUtterance hi·ªán t·∫°i
        let isPlaying = false; // Tr·∫°ng th√°i ph√°t (ƒëang ph√°t/d·ª´ng)
        let progressInterval = null; // ID c·ªßa interval cho thanh ti·∫øn tr√¨nh
        let currentIndex = -1; // Ch·ªâ m·ª•c c·ªßa b√†i th∆° ƒëang ƒë∆∞·ª£c ch·ªçn trong originalData
        let autoPlay = true; // C·∫¨P NH·∫¨T: L·∫∑p l·∫°i ƒë∆∞·ª£c b·∫≠t l√†m m·∫∑c ƒë·ªãnh
        
        // --- THAM CHI·∫æU ƒê·∫æN C√ÅC PH·∫¶N T·ª¨ DOM ---
        const searchInput = document.getElementById("search");
        const voiceSearchBtn = document.getElementById("voice-search-btn");
        const searchSuggestions = document.getElementById("search-suggestions");
        const searchResultCountElement = document.getElementById("search-result-count");
        const tocContainer = document.getElementById("toc");
        const accordionContainer = document.getElementById("accordion");
        const fallbackElement = document.getElementById("fallback");
        const dropdownToggle = document.querySelector('.dropdown-toggle');
        
        // C√°c n√∫t ƒëi·ªÅu khi·ªÉn
        const playPauseBtn = document.getElementById("play-pause-btn");
        const prevBtn = document.getElementById("prev-btn");
        const nextBtn = document.getElementById("next-btn");
        const loopBtn = document.getElementById("loop-btn");
        const volumeSlider = document.getElementById("volume-slider");
        const volumeValue = document.getElementById("volume-value");
        const rateSlider = document.getElementById("rate-slider");
        const rateValue = document.getElementById("rate-value");
        const progressBar = document.querySelector(".speech-progress-bar");
        const scrollToTopButton = document.getElementById("scroll-to-top-button");
        const scrollToEndButton = document.getElementById("scroll-to-end-button"); // C·∫¨P NH·∫¨T

        // === TH√äM M·ªöI: Tham chi·∫øu Modal ===
        const shareModalOverlay = document.getElementById("share-modal-overlay");
        const shareModalCloseBtn = document.getElementById("share-modal-close-btn");

        /**
         * H√†m tr·ª£ gi√∫p ƒë·ªÉ lo·∫°i b·ªè d·∫•u ti·∫øng Vi·ªát v√† chuy·ªÉn v·ªÅ ch·ªØ th∆∞·ªùng.
         * @param {string} str - Chu·ªói ƒë·∫ßu v√†o.
         * @returns {string} Chu·ªói ƒë√£ ƒë∆∞·ª£c chu·∫©n h√≥a.
         */
        function removeVietnameseAccents(str) {
            if (!str) return '';
            str = str.toLowerCase();
            str = str.replace(/√†|√°|·∫°|·∫£|√£|√¢|·∫ß|·∫•|·∫≠|·∫©|·∫´|ƒÉ|·∫±|·∫Ø|·∫∑|·∫≥|·∫µ/g, "a");
            str = str.replace(/√®|√©|·∫π|·∫ª|·∫Ω|√™|·ªÅ|·∫ø|·ªá|·ªÉ|·ªÖ/g, "e");
            str = str.replace(/√¨|√≠|·ªã|·ªâ|ƒ©/g, "i");
            str = str.replace(/√≤|√≥|·ªç|·ªè|√µ|√¥|·ªì|·ªë|·ªô|·ªï|·ªó|∆°|·ªù|·ªõ|·ª£|·ªü|·ª°/g, "o");
            str = str.replace(/√π|√∫|·ª•|·ªß|≈©|∆∞|·ª´|·ª©|·ª±|·ª≠|·ªØ/g, "u");
            str = str.replace(/·ª≥|√Ω|·ªµ|·ª∑|·ªπ/g, "y");
            str = str.replace(/ƒë/g, "d");
            return str;
        }

        /**
         * Kh·ªüi t·∫°o ch·ªâ m·ª•c Fuse.js ƒë·ªÉ t√¨m ki·∫øm m·ªù.
         * @param {Array} data - T·∫≠p d·ªØ li·ªáu ƒë·ªÉ l·∫≠p ch·ªâ m·ª•c.
         */
        function createFuseIndex(data) {
            fuse = new Fuse(data, {
                keys: [
                    { name: "Ti√™u ƒë·ªÅ", weight: 0.7 },
                    { name: "searchable_content", weight: 0.3 }
                ],
                threshold: 0.4,
                distance: 200,
                includeScore: true,
            });
        }

        /**
         * T·∫£i v√† ph√¢n t√≠ch d·ªØ li·ªáu t·ª´ Google Sheet.
         */
        async function loadData() {
            try {
                const response = await fetch(SHEET_URL);
                const csv = await response.text();
                const { data } = Papa.parse(csv, { header: true, skipEmptyLines: true });
                
                originalData = data
                    .filter(row => row["Ti√™u ƒë·ªÅ"] || row["N·ªôi dung"])
                    .map(row => ({
                        ...row,
                        searchable_content: removeVietnameseAccents(row["N·ªôi dung"])
                    }));

                createFuseIndex(originalData);
                displayData = originalData; // S·ª¨A L·ªñI: Kh·ªüi t·∫°o displayData
                renderContent(displayData);
                
                loopBtn.classList.toggle("active-auto", autoPlay);
                
            } catch (e) {
                console.error("L·ªói khi t·∫£i d·ªØ li·ªáu:", e);
                if (tocContainer) tocContainer.style.display = "none";
                if (accordionContainer) accordionContainer.style.display = "none";
                if (fallbackElement) fallbackElement.style.display = "block";
                if (searchInput) {
                    searchInput.disabled = true;
                    searchInput.placeholder = "T√¨m ki·∫øm kh√¥ng kh·∫£ d·ª•ng";
                }
            }
        }

        /**
         * ƒê√°nh d·∫•u (highlight) m·ªôt t·ª´ kh√≥a trong vƒÉn b·∫£n.
         * @param {string} text - VƒÉn b·∫£n g·ªëc.
         * @param {string} keyword - T·ª´ kh√≥a c·∫ßn ƒë√°nh d·∫•u.
         * @returns {string} VƒÉn b·∫£n d·∫°ng HTML v·ªõi t·ª´ kh√≥a ƒë√£ ƒë∆∞·ª£c ƒë√°nh d·∫•u.
         */
        function highlightKeyword(text, keyword) {
            if (!text || !keyword) return text;
            const normalizedKeyword = removeVietnameseAccents(keyword.trim());
            if (!normalizedKeyword) return text;
            const escapedKeyword = normalizedKeyword.replace(/[-/\\^$*+?.()|[\]{}]/g, '\\$&');
            const pattern = new RegExp(escapedKeyword, 'gi');
            const normalizedText = removeVietnameseAccents(text);
            
            let result = "";
            let lastIndex = 0;
            let match;

            while ((match = pattern.exec(normalizedText)) !== null) {
                const start = match.index;
                const end = start + match[0].length;
                result += text.substring(lastIndex, start);
                result += `<mark class="highlight">${text.substring(start, end)}</mark>`;
                lastIndex = end;
            }
            result += text.substring(lastIndex);
            return result;
        }
        
        /**
         * Hi·ªÉn th·ªã c√°c b√†i th∆° l√™n DOM.
         * @param {Array} dataToRender - M·∫£ng c√°c ƒë·ªëi t∆∞·ª£ng b√†i th∆° c·∫ßn hi·ªÉn th·ªã.
         */
        function renderContent(dataToRender) {
            if (!tocContainer || !accordionContainer) return; // S·ª¨A L·ªñI: Th√™m ki·ªÉm tra null
            tocContainer.innerHTML = '';
            accordionContainer.innerHTML = '';
            const keyword = searchInput.value.trim();

            if (dataToRender.length === 0 && keyword) {
                accordionContainer.innerHTML = '<p style="text-align: center; color: var(--text-color-secondary);">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ n√†o.</p>';
                if(searchResultCountElement) searchResultCountElement.textContent = "Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ n√†o.";
                return;
            }

            dataToRender.forEach((row) => {
                const originalIndex = originalData.findIndex(item => item === row);
                if(originalIndex === -1) return;

                const title = row["Ti√™u ƒë·ªÅ"] || `B√†i ${originalIndex + 1}`;
                const content = row["N·ªôi dung"] || "";
                const image = row["·∫¢nh"] || "";

                const displayTitle = highlightKeyword(title, keyword);
                const displayContent = highlightKeyword(content.replace(/\n/g, "<br>"), keyword);
                const details = document.createElement("details");
                details.id = `item-${originalIndex}`;
                details.onclick = (e) => handleDetailsClick(e, details, title, content, originalIndex);

                const summary = document.createElement("summary");
                summary.innerHTML = displayTitle;
                const body = document.createElement("div");
                body.className = "content-body";
                body.innerHTML = displayContent + (image ? `<img src="${image}" onerror="this.style.display='none';">` : "");

                const shareContainer = document.createElement('div');
                shareContainer.className = 'share-button-container';
                const shareBtn = document.createElement('button');
                shareBtn.className = 'share-btn';
                shareBtn.textContent = 'üîó Chia s·∫ª l·ªùi th∆°';
                shareBtn.onclick = (e) => {
                    e.stopPropagation();
                    const textToCopy = `${title}\n\n${content}`;
                    copyToClipboard(textToCopy);
                };
                shareContainer.appendChild(shareBtn);
                body.appendChild(shareContainer);
                details.append(summary, body);
                accordionContainer.appendChild(details);

                const link = document.createElement("a");
                link.href = `#item-${originalIndex}`;
                link.innerHTML = title;
                link.dataset.originalIndex = originalIndex; // S·ª¨A L·ªñI: S·ª≠ d·ª•ng dataset ƒë·ªÉ l∆∞u tr·ªØ index
                link.onclick = (e) => handleTocClick(e, originalIndex, title, content);
                tocContainer.appendChild(link);
            });
        }

        /**
         * X·ª≠ l√Ω s·ª± ki·ªán nh·∫•n v√†o c√°c m·ª•c accordion (<details>).
         */
        function handleDetailsClick(e, details, title, content, index) {
            e.preventDefault();
            const wasOpen = details.hasAttribute('open');
            if (!wasOpen) {
                openPoem(index, title, content);
            } else {
                closePoem(index);
            }
        }
        
        /**
         * X·ª≠ l√Ω s·ª± ki·ªán nh·∫•n v√†o c√°c li√™n k·∫øt trong TOC.
         */
        function handleTocClick(e, index, title, content) {
            e.preventDefault();
            openPoem(index, title, content);
            const targetDetails = document.getElementById(`item-${index}`);
            if(targetDetails) {
                targetDetails.scrollIntoView({ behavior: "smooth", block: "center" });
            }
        }
        
        /**
         * M·ªü m·ªôt b√†i th∆° c·ª• th·ªÉ v√† chu·∫©n b·ªã ƒë·ªÉ ph√°t.
         */
        function openPoem(index, title, content) {
            document.querySelectorAll('details[open]').forEach(d => d.removeAttribute('open'));
            const targetDetails = document.getElementById(`item-${index}`);
            if (targetDetails) {
                targetDetails.setAttribute('open', '');
            }
            highlightTOC(index);
            currentIndex = index;
            if (loopBtn) loopBtn.classList.toggle("active-auto", autoPlay);
            preparePlayback(title, content);
            play();
        }

        /**
         * ƒê√≥ng b√†i th∆° ƒëang m·ªü v√† d·ª´ng ph√°t.
         */
        function closePoem(index) {
            const targetDetails = document.getElementById(`item-${index}`);
            if (targetDetails) {
                targetDetails.removeAttribute('open');
            }
            highlightTOC(-1);
            if(currentIndex === index) {
                stop();
                currentIndex = -1;
            }
        }

        /**
         * Chu·∫©n b·ªã vƒÉn b·∫£n ƒë·ªÉ t·ªïng h·ª£p gi·ªçng n√≥i m√† kh√¥ng ph√°t ngay l·∫≠p t·ª©c.
         */
        function preparePlayback(title, content) {
            stop();
            const textToSpeak = `${title}. ${content}`;
            currentUtterance = new SpeechSynthesisUtterance(textToSpeak);
            const voice = speechSynthesis.getVoices().find(v => v.lang.startsWith("vi")) || speechSynthesis.getVoices()[0];
            if (voice) currentUtterance.voice = voice;
            
            if (volumeSlider) currentUtterance.volume = parseFloat(volumeSlider.value);
            if (rateSlider) currentUtterance.rate = parseFloat(rateSlider.value);

            currentUtterance.onstart = () => {
                isPlaying = true;
                if (playPauseBtn) playPauseBtn.textContent = '‚è∏Ô∏è';
                const estimatedDuration = (textToSpeak.length / (currentUtterance.rate * 15)) * 1000;
                let startTime = Date.now();
                if(progressInterval) clearInterval(progressInterval);
                progressInterval = setInterval(() => {
                    let elapsed = Date.now() - startTime;
                    let progress = Math.min(100, (elapsed / estimatedDuration) * 100);
                    if (progressBar) progressBar.style.width = `${progress}%`;
                }, 100);
            };
            
            currentUtterance.onend = () => {
                if (progressInterval) clearInterval(progressInterval);
                if (progressBar) progressBar.style.width = '100%';
                if (autoPlay) {
                    playRandom();
                } else {
                    stop(false);
                }
            };
        }

        // --- C√ÅC H√ÄM ƒêI·ªÄU KHI·ªÇN PH√ÅT ---
        function play() {
            if (!currentUtterance) return;
            speechSynthesis.speak(currentUtterance);
        }
        
        function pause() {
            speechSynthesis.pause();
            isPlaying = false;
            if (playPauseBtn) playPauseBtn.textContent = '‚ñ∂Ô∏è';
            if (progressInterval) clearInterval(progressInterval);
        }
        
        function resume() {
            speechSynthesis.resume();
            isPlaying = true;
            if (playPauseBtn) playPauseBtn.textContent = '‚è∏Ô∏è';
        }
        
        function stop(cancelSpeech = true) {
            if(cancelSpeech) speechSynthesis.cancel();
            isPlaying = false;
            if (playPauseBtn) playPauseBtn.textContent = '‚ñ∂Ô∏è';
            if (progressInterval) clearInterval(progressInterval);
            if (progressBar) progressBar.style.width = '0%';
        }
        
        function playRandom() {
            if (originalData.length === 0) return;
            let nextIndex;
            if (originalData.length > 1) {
                do {
                    nextIndex = Math.floor(Math.random() * originalData.length);
                } while (nextIndex === currentIndex);
            } else {
                nextIndex = 0;
            }
            const nextPoem = originalData[nextIndex];
            openPoem(nextIndex, nextPoem["Ti√™u ƒë·ªÅ"], nextPoem["N·ªôi dung"]);
        }
        
        function playNext() {
            if (originalData.length === 0) return;
            let nextIdx = (currentIndex + 1) % originalData.length;
            const nextPoem = originalData[nextIdx];
            openPoem(nextIdx, nextPoem["Ti√™u ƒë·ªÅ"], nextPoem["N·ªôi dung"]);
        }
        
        function playPrevious() {
            if (originalData.length === 0) return;
            let prevIdx = (currentIndex - 1 + originalData.length) % originalData.length;
            const prevPoem = originalData[prevIdx];
            openPoem(prevIdx, prevPoem["Ti√™u ƒë·ªÅ"], prevPoem["N·ªôi dung"]);
        }

        /**
         * ƒê√°nh d·∫•u li√™n k·∫øt ƒëang ho·∫°t ƒë·ªông trong TOC.
         * @param {number} indexToHighlight - Ch·ªâ m·ª•c c·ªßa b√†i th∆° c·∫ßn ƒë√°nh d·∫•u trong originalData.
         */
        function highlightTOC(indexToHighlight) {
            const tocLinks = document.querySelectorAll(".toc a");
            tocLinks.forEach(link => {
                if (link.dataset.originalIndex) { // S·ª¨A L·ªñI: Lu√¥n ki·ªÉm tra dataset
                    const linkIndex = parseInt(link.dataset.originalIndex, 10);
                    link.classList.toggle("active", linkIndex === indexToHighlight);
                }
            });
        }

        /**
         * Hi·ªÉn th·ªã c√°c g·ª£i √Ω t√¨m ki·∫øm.
         * @param {Array} fuseResults - K·∫øt qu·∫£ t·ª´ Fuse.js.
         */
        function displaySuggestions(fuseResults) {
            if (!searchSuggestions) return; // S·ª¨A L·ªñI: Th√™m ki·ªÉm tra null
            searchSuggestions.innerHTML = '';
            if (fuseResults.length === 0 || searchInput.value.trim() === "") {
                searchSuggestions.style.display = 'none';
                return;
            }
            fuseResults.slice(0, 5).forEach(({ item }) => {
                const li = document.createElement('li');
                li.textContent = item["Ti√™u ƒë·ªÅ"];
                li.onmousedown = () => {
                    searchInput.value = item["Ti√™u ƒë·ªÅ"];
                    searchSuggestions.style.display = 'none';
                    handleSearch();
                };
                searchSuggestions.appendChild(li);
            });
            searchSuggestions.style.display = 'block';
        }

        /**
         * Th·ª±c hi·ªán t√¨m ki·∫øm v√† hi·ªÉn th·ªã k·∫øt qu·∫£.
         */
        function handleSearch() {
            if (!searchInput) return; // S·ª¨A L·ªñI: Th√™m ki·ªÉm tra null
            const keyword = searchInput.value.trim();
            if (!keyword) {
                if(searchResultCountElement) searchResultCountElement.textContent = "";
                displayData = originalData;
                renderContent(displayData);
                return;
            }
            if (fuse) {
                const results = fuse.search(keyword);
                displayData = results.map(r => r.item);
                if(searchResultCountElement) searchResultCountElement.textContent = `T√¨m th·∫•y ${displayData.length} k·∫øt qu·∫£`;
                renderContent(displayData);
            }
        }

        // === TH√äM M·ªöI: H√†m sao ch√©p v√† qu·∫£n l√Ω Modal ===
        function copyToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.top = 0;
            textArea.style.left = 0;
            textArea.style.opacity = 0;
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                if (shareModalOverlay) shareModalOverlay.style.display = 'flex';
            } catch (err) {
                console.error('Kh√¥ng th·ªÉ sao ch√©p vƒÉn b·∫£n: ', err);
                alert('R·∫•t ti·∫øc, kh√¥ng th·ªÉ sao ch√©p vƒÉn b·∫£n.');
            }
            document.body.removeChild(textArea);
        }
        function closeModal() {
            if (shareModalOverlay) shareModalOverlay.style.display = 'none';
        }
        
        // --- B·ªò L·∫ÆNG NGHE S·ª∞ KI·ªÜN ---
        if(playPauseBtn) playPauseBtn.addEventListener('click', () => {
            if(speechSynthesis.speaking) {
                if (isPlaying) {
                    pause();
                } else {
                    resume();
                }
            } else if (currentUtterance) {
                play();
            } else if (currentIndex !== -1) {
                const poem = originalData[currentIndex];
                openPoem(currentIndex, poem["Ti√™u ƒë·ªÅ"], poem["N·ªôi dung"]);
            }
        });

        if(nextBtn) nextBtn.addEventListener('click', playNext);
        if(prevBtn) prevBtn.addEventListener('click', playPrevious);

        if(loopBtn) loopBtn.addEventListener('click', () => {
            autoPlay = !autoPlay;
            loopBtn.classList.toggle("active-auto", autoPlay);
        });

        if(volumeSlider) volumeSlider.addEventListener('input', (e) => {
            if(volumeValue) volumeValue.textContent = Math.round(parseFloat(e.target.value) * 10);
            if (currentIndex !== -1) {
                const wasSpeaking = speechSynthesis.speaking;
                const poem = originalData[currentIndex];
                preparePlayback(poem["Ti√™u ƒë·ªÅ"], poem["N·ªôi dung"]);
                if (wasSpeaking) {
                    play();
                }
            }
        });

        if(rateSlider) rateSlider.addEventListener('input', (e) => {
            if(rateValue) rateValue.textContent = `${parseFloat(e.target.value).toFixed(1)}x`;
            if (currentIndex !== -1) {
                const wasSpeaking = speechSynthesis.speaking;
                const poem = originalData[currentIndex];
                preparePlayback(poem["Ti√™u ƒë·ªÅ"], poem["N·ªôi dung"]);
                if (wasSpeaking) {
                    play();
                }
            }
        });

        if(searchInput) {
            searchInput.addEventListener("input", handleSearch);
            searchInput.addEventListener("keyup", (e) => {
                if(e.key === 'Enter') {
                    handleSearch();
                    if(searchSuggestions) searchSuggestions.style.display = 'none';
                }
            });
            searchInput.addEventListener('blur', () => {
                setTimeout(() => { 
                    if(searchSuggestions) searchSuggestions.style.display = 'none'; 
                }, 150);
            });
        }
        
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (SpeechRecognition && voiceSearchBtn) {
            const recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.lang = 'vi-VN';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;
            voiceSearchBtn.style.display = 'flex';

            voiceSearchBtn.addEventListener('click', () => {
                if (isPlaying || speechSynthesis.speaking) {
                    stop();
                }
                try {
                    recognition.start();
                } catch(e) {
                    console.error("L·ªói khi b·∫Øt ƒë·∫ßu nh·∫≠n d·∫°ng gi·ªçng n√≥i:", e);
                }
            });

            recognition.onstart = () => {
                voiceSearchBtn.classList.add('listening');
                voiceSearchBtn.title = 'ƒêang l·∫Øng nghe...';
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                if(searchInput) searchInput.value = transcript;
                handleSearch();
            };

            recognition.onerror = (event) => {
                console.error('L·ªói nh·∫≠n d·∫°ng gi·ªçng n√≥i:', event.error);
                voiceSearchBtn.title = 'L·ªói! Th·ª≠ l·∫°i?';
            };

            recognition.onend = () => {
                voiceSearchBtn.classList.remove('listening');
                voiceSearchBtn.title = 'T√¨m ki·∫øm b·∫±ng gi·ªçng n√≥i';
            };
        } else {
            if (voiceSearchBtn) {
                voiceSearchBtn.style.display = 'none';
            }
            console.warn('Tr√¨nh duy·ªát n√†y kh√¥ng h·ªó tr·ª£ Web Speech API.');
        }
        
        if(dropdownToggle) dropdownToggle.addEventListener('click', () => {
            dropdownToggle.closest('.dropdown').classList.toggle('active');
        });

        window.addEventListener('click', (event) => {
            if (!event.target.matches('.dropdown-toggle')) {
                document.querySelectorAll('.dropdown.active').forEach(d => d.classList.remove('active'));
            }
        });

        // C·∫¨P NH·∫¨T: G√°n s·ª± ki·ªán cho c·∫£ 2 n√∫t cu·ªôn
        if(scrollToTopButton) scrollToTopButton.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        if(scrollToEndButton) scrollToEndButton.addEventListener('click', () => {
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        });
        
        if(shareModalCloseBtn) shareModalCloseBtn.addEventListener('click', closeModal);
        if(shareModalOverlay) shareModalOverlay.addEventListener('click', (e) => {
            if (e.target === shareModalOverlay) {
                closeModal();
            }
        });

        window.speechSynthesis.onvoiceschanged = () => {};
        
        loadData();
    });
  </script>
</body>
</html>
