<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Đang chuyển hướng...</title>
  <!-- Tối ưu tốc độ tải -->
  <link rel="dns-prefetch" href="//thiensutinhquang.github.io">
  <link rel="preconnect" href="https://thiensutinhquang.github.io">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
  </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="bg-white p-8 rounded-xl shadow-lg text-center max-w-sm w-full mx-4">
    <h1 class="text-2xl font-bold mb-4 text-gray-800">⚠️ Mở bằng trình duyệt mặc định</h1>
    <p class="text-gray-600 mb-6">Để có trải nghiệm tốt nhất và sử dụng các tính năng của ứng dụng, vui lòng nhấn nút bên dưới để tiếp tục.</p>
    <button id="openExternalBrowser" class="w-full text-white font-bold py-3 px-4 rounded-lg transition-transform duration-150 ease-in-out transform hover:scale-105"
            style="background: linear-gradient(135deg, #4285F4 0%, #34A853 100%);">
      MỞ TRONG TRÌNH DUYỆT
    </button>
  </div>

  <script>
  (function(){
    // URL đích. Đây là một Universal Link (iOS) và App Link (Android)
    const targetURL    = 'https://thiensutinhquang.github.io/playtholientuc/';
    
    // --- BƯỚC 1: PHÁT HIỆN TRÌNH DUYỆT TRONG ỨNG DỤNG ---
    const ua           = navigator.userAgent || '';
    const isAndroid    = /Android/i.test(ua);
    const isIOS        = /iPhone|iPad|iPod/i.test(ua);
    const inAppKeywords = ['FBAV', 'FBAN', 'Zalo', 'Messenger', 'Telegram', 'Viber'];
    const isInApp       = inAppKeywords.some(keyword => ua.includes(keyword));

    // Nếu người dùng đã ở trình duyệt chuẩn, App Link/Universal Link sẽ tự được kích hoạt.
    // Chúng ta chuyển thẳng đến trang đích.
    if (!isInApp) {
      window.location.replace(targetURL);
      return;
    }

    // --- BƯỚC 2: LOGIC THOÁT KHỎI TRÌNH DUYỆT TRONG ỨNG DỤNG KHI CLICK NÚT ---
    // Mục tiêu là đưa targetURL ra trình duyệt mặc định của hệ thống.
    // Tại đó, iOS/Android sẽ tự xử lý App Link/Universal Link.

    // Hàm cho Android: Sử dụng Intent để yêu cầu mở URL trong trình duyệt cụ thể.
    function tryOpenInAndroid(packages) {
      let i = 0;
      const attemptNext = () => {
        if (i >= packages.length) {
          // Nếu không có trình duyệt nào, đưa tới Play Store để cài Chrome.
          window.location.href = 'https://play.google.com/store/apps/details?id=com.android.chrome';
          return;
        }
        
        const pkg = packages[i++];
        const url = new URL(targetURL);
        // Intent này yêu cầu mở URL trong một package cụ thể (trình duyệt).
        // Khi đã ra ngoài trình duyệt đó, Android sẽ nhận diện App Link và mở ứng dụng nếu có.
        const intent = `intent://${url.host}${url.pathname}${url.search}` +
                       `#Intent;scheme=${url.protocol.replace(':','')};` +
                       `package=${pkg};` +
                       `S.browser_fallback_url=${encodeURIComponent(targetURL)};end`;
        window.location.href = intent;
        setTimeout(attemptNext, 1200);
      };
      attemptNext();
    }

    // Hàm cho iOS: Sử dụng URL Scheme của các trình duyệt để mở URL.
    function tryOpenInIOS(schemes, appStoreLink) {
      let i = 0;
      const attemptNext = () => {
        if (i >= schemes.length) {
          // Nếu không có, đưa tới App Store để cài Chrome.
          window.location.href = appStoreLink;
          return;
        }
        const scheme = schemes[i++];
        // Thay thế https:// bằng scheme của trình duyệt, ví dụ: googlechrome://
        // Khi Chrome mở link, iOS sẽ nhận diện Universal Link và mở ứng dụng.
        const url = targetURL.replace(/^https?:\/\//, scheme + '://');
        window.location.href = url;
        setTimeout(attemptNext, 1200);
      };
      attemptNext();
    }

    // Gắn sự kiện 'click' cho nút
    document.getElementById('openExternalBrowser').addEventListener('click', () => {
      // Thứ tự ưu tiên: Chrome -> Firefox -> Cốc Cốc -> Brave -> Edge
      const androidPackages = [
        'com.android.chrome', 'org.mozilla.firefox', 'com.coccoc.browser', 
        'com.brave.browser', 'com.microsoft.emmx'
      ];
      const iosSchemes = [
        'googlechromes', 'googlechrome', 'firefox', 'brave', 'microsoft-edge'
      ];

      if (isAndroid) {
        tryOpenInAndroid(androidPackages);
      } else if (isIOS) {
        // Link App Store của Chrome làm phương án dự phòng
        tryOpenInIOS(iosSchemes, 'itms-apps://itunes.apple.com/app/id535886823');
      } else {
        // Fallback cho desktop
        window.open(targetURL, '_blank');
      }
    });
  })();
  </script>
</body>
</html>
